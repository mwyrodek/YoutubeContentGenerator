using System;
using System.Collections.Generic;
using Castle.Core.Logging;
using Microsoft.Extensions.Logging;
using Moq;
using Newtonsoft.Json;
using NUnit.Framework;
using YCG.Tests.Generator;
using YoutubeContentGenerator.DataExtractor;

namespace YCG.Tests
{
    [TestFixture]
    public class DataTransformTest
    {
        private TransformXmindData sut;
        string validJson8episodes4empty = "[{\"id\":\"0c09cfc2fa5abeb4438bcb0fee\",\"class\":\"sheet\",\"title\":\"Map 1\",\"rootTopic\":{\"id\":\"b9aa22deba98b3b20c7ac8aca2\",\"class\":\"topic\",\"title\":\"Topics for future teas\",\"structureClass\":\"org.xmind.ui.map.unbalanced\",\"extensions\":[{\"content\":[{\"content\":\"3\",\"name\":\"right-number\"}],\"provider\":\"org.xmind.ui.map.unbalanced\"}],\"children\":{\"detached\":[{\"title\":\"my channel\",\"id\":\"acaab33c-af84-4968-8b85-abe9eea1c7b2\",\"children\":{\"attached\":[{\"id\":\"1a7f56f0-65d1-4195-b202-b13ea90501dd\",\"title\":\"https://youtube.com/c/ITeaMorning\"}]},\"position\":{\"x\":403,\"y\":-1984.5}},{\"title\":\"tag extration\",\"id\":\"b81989d2-c66f-4a91-b419-ad0130ab9f6b\",\"position\":{\"x\":393,\"y\":-1800.75},\"children\":{\"attached\":[{\"id\":\"3f52603c-29f1-4768-8e2f-5508046c963d\",\"title\":\"https://monkeylearn.com/\"},{\"id\":\"7dd4c995-f9f3-4fef-874a-14b20abcfc87\",\"title\":\"https://www.cortical.io/freetools/extract-keywords/\"}]}}],\"attached\":[{\"id\":\"8e92e0b4-6f79-4920-a4e8-5c3a36dbfa31\",\"title\":\"day 1\",\"children\":{\"attached\":[{\"id\":\"943bc669-0460-454d-ae26-418696341dc2\",\"title\":\"Testing\",\"children\":{\"attached\":[{\"title\":\"RiskStromingOnline\",\"id\":\"4d37cbb1-6456-4b10-93ce-9a8ccc7744fd\",\"children\":{\"attached\":[{\"id\":\"a4d91ab0-6f13-435d-80a0-186cfd3e04da\",\"title\":\"https://riskstorming.praxio.be/\"}]}}]}},{\"id\":\"cff48b42-24ac-4c31-8d8c-fad0e4a1a950\",\"title\":\"programming\",\"children\":{\"attached\":[{\"id\":\"9f06f8ef-be23-40ac-a484-0d862f80fefa\",\"title\":\"Post-Commit Review\",\"children\":{\"attached\":[{\"id\":\"dcb97e2c-8377-4234-a8af-f5111979be45\",\"title\":\"https://medium.com/@copyconstruct/post-commit-reviews-b4cc2163ac7a\"}]}}]}},{\"id\":\"8156eaa8-926c-4bc6-b955-dc2d6a172472\",\"title\":\"Craftsmanship/Busisness/Softskill\",\"children\":{\"attached\":[{\"id\":\"0cb81b44-96ab-46c8-a73e-78717d84dfca\",\"title\":\"Surprising Ingredient for Better Networking for Entrepreneurs\",\"children\":{\"attached\":[{\"id\":\"09f6ed30-ca64-43c6-b6b5-a041a7a62f3c\",\"title\":\"https://www.growthclub.online/post/surprising-ingredient-for-better-networking-for-entrepreneurs\"}]}}]}},{\"id\":\"6f979d8f-41f6-42a2-a22e-6492d921c8cc\",\"title\":\"Other\",\"children\":{\"attached\":[{\"id\":\"177ae302-93d9-4c30-9844-15474f252b23\",\"title\":\"Ubisoft Spent Years Protecting Mental And Physical Abusers\",\"children\":{\"attached\":[{\"id\":\"9a7386c9-d98a-45f4-8132-1195ea7cc90c\",\"title\":\"https://www.youtube.com/watch?v=BRhYT5Lgp98\"}]}}]}}]}},{\"title\":\"day 2\",\"id\":\"b98237e7-9a23-4d44-9ae2-665fbe6655ac\",\"children\":{\"attached\":[{\"id\":\"d4c16e1a-20f7-4094-98bf-2622c8e67b0b\",\"title\":\"Testing\",\"children\":{\"attached\":[{\"id\":\"da84eeb5-c7fa-452b-97ec-ed87cccec04e\",\"title\":\"DevOwls Tech - ReportPortal - Czym jest ReportPortal?\",\"children\":{\"attached\":[{\"id\":\"0723cccd-8ecf-4c46-9ebb-70b1dea6ab79\",\"title\":\"https://www.youtube.com/watch?v=0J6KAWZTyCM\"}]}}]}},{\"id\":\"46ce1122-fde8-4661-85f7-95004571ceea\",\"title\":\"programming\",\"children\":{\"attached\":[{\"id\":\"28035905-0cbc-43cc-a9e4-f1d9f465c1fb\",\"title\":\"How To Access SQL Generated By Entity Framework Core 3\",\"children\":{\"attached\":[{\"id\":\"f10c69e5-2c8d-44b4-8090-61f2aa0899b5\",\"title\":\"https://christianfindlay.com/2020/07/19/sql-generated-by-entity-framework-core\"}]}}]}},{\"id\":\"79d335b1-23ad-4bf1-a6e1-390417c798bd\",\"title\":\"Craftsmanship/Busisness/Softskill\",\"children\":{\"attached\":[{\"id\":\"9b493f5a-74ff-42b8-a7a1-52700ad15db7\",\"title\":\"I am Krzysztof Cwalina, the author of .NET Framework Design Guidelines, and a long time .NET Architect at Microsoft. AMA!\",\"children\":{\"attached\":[{\"id\":\"2417247a-6cb7-4c72-81a9-7e1f3bcf7443\",\"title\":\"https://www.reddit.com/r/dotnet/comments/hqies9/i_am_krzysztof_cwalina_the_author_of_net/\"}]}}]}},{\"id\":\"82b3db9c-c44a-4b45-9f1a-03adac99cce9\",\"title\":\"Other\",\"children\":{\"attached\":[{\"id\":\"25a17510-fdc8-425a-8441-a2fa39d84fac\",\"title\":\"How do you get over bad days?\",\"children\":{\"attached\":[{\"id\":\"f55231d8-a88d-424a-9c1d-f70aead97b5e\",\"title\":\"https://dev.to/cilvako/how-do-you-get-over-bad-days-4mo0\"}]}}]}}]}},{\"title\":\"day 3\",\"id\":\"58b92b4d-f653-47b6-a1fe-cd9bdc575412\",\"children\":{\"attached\":[{\"id\":\"3a43e109-0354-4412-8aa8-28ad3c9111f1\",\"title\":\"Testing\",\"children\":{\"attached\":[{\"id\":\"81e9b125-42a4-48cd-bacd-f579cb7b455b\",\"title\":\"programista artkuł o testowaniu\",\"children\":{\"attached\":[{\"id\":\"a003aa1b-fdc3-4091-a257-032eeb77f1be\",\"title\":\"https://programistamag.pl/programista-42020-91-czerwiec-lipiec-2020-ethernet-w-fpga/\"}]}}]}},{\"id\":\"9c5e6bab-9c6d-4386-b1a0-71b20d0de067\",\"title\":\"programming\",\"children\":{\"attached\":[{\"id\":\"0525c8e8-b415-4d22-bfcd-05f493084a92\",\"title\":\"Systems design for advanced beginners\",\"children\":{\"attached\":[{\"id\":\"12bcbbbd-9885-4ec3-b495-9609508b75c8\",\"title\":\"https://robertheaton.com/2020/04/06/systems-design-for-advanced-beginners/\"}]}}]}},{\"id\":\"c67e0208-9fe4-466f-90ff-f6e8c6e285e1\",\"title\":\"Craftsmanship/Busisness/Softskill\",\"children\":{\"attached\":[{\"id\":\"27d611dd-c7aa-47eb-bce9-40a76ac23ef9\",\"title\":\"12 Signs You’re Working in a Feature Factory — 3 Years Later\",\"children\":{\"attached\":[{\"id\":\"4068398d-4412-4567-9c09-fe483eb2c2be\",\"title\":\"https://amplitude.com/blog/12-signs-youre-working-in-a-feature-factory-3-years-later\"}]}}]}},{\"id\":\"3a701574-9e49-477d-9d1b-950ccdfdef80\",\"title\":\"Other\",\"children\":{\"attached\":[{\"id\":\"db845312-9752-463d-8754-0cf7ae22cabd\",\"title\":\"Writing Tips As A Developer - Reading Time: 4 Mins\",\"children\":{\"attached\":[{\"id\":\"5cf5be5c-6e73-4ed8-9b48-45ac45beec1b\",\"title\":\"https://www.maxongzb.com/writing-tips-as-a-developer-reading-time-4-mins/\"}]}}]}}]},\"position\":{\"x\":220,\"y\":130.5}},{\"id\":\"68570517-457a-470c-9c3b-447b2584b16a\",\"title\":\"day xxx\",\"children\":{\"attached\":[{\"id\":\"c5e0bd59-bfe6-4a5a-b282-3fd138c71a78\",\"title\":\"Testing\",\"children\":{\"attached\":[{\"id\":\"d545c9fe-aa5f-4550-8ede-cd5741bae17c\",\"title\":\"It’s time to retire our test case management tools\",\"children\":{\"attached\":[{\"id\":\"b59769d2-2c3d-40c3-82a3-0133071980ea\",\"title\":\"https://testingcurve.wordpress.com/2020/07/19/its-time-to-retire-our-test-case-management-tools/\"}]}}]}},{\"id\":\"0f748a46-b648-473a-9213-481a9cee1f3f\",\"title\":\"programming\",\"children\":{\"attached\":[{\"id\":\"bcc57b3b-d47e-434f-8b99-3509117a1491\",\"title\":\"Essays on programming I think about a lot\",\"children\":{\"attached\":[{\"id\":\"dfb21425-b407-4f6d-898b-6246b681e456\",\"title\":\"https://www.benkuhn.net/progessays\"}]}}]}},{\"id\":\"759a858b-e421-4be1-b894-e7527229b429\",\"title\":\"Craftsmanship/Busisness/Softskill\",\"children\":{\"attached\":[{\"id\":\"4405a295-ee1b-4ec1-ab23-55de1046a01b\",\"title\":\"5 things I hate about Scrum\",\"children\":{\"attached\":[{\"id\":\"3358906c-4514-435c-84f3-10224cc40e4d\",\"title\":\"https://medium.com/serious-scrum/5-things-i-hate-about-scrum-aa52908dcd78\"}]}}]}},{\"id\":\"7ade6346-7363-4d70-bd4b-ae67fa59faaf\",\"title\":\"Other\",\"children\":{\"attached\":[{\"id\":\"cb866775-c662-45b6-9cfd-3d5570e19619\",\"title\":\"Why you're procrastinating more\",\"children\":{\"attached\":[{\"id\":\"64b3128d-78ee-490e-b255-99ffc9a4c383\",\"title\":\"https://www.linkedin.com/feed/news/why-youre-procrastinating-more-4901532/\"}]}}]}}]}},{\"id\":\"70f2dd04-9eb8-414f-8468-e51dd640a64d\",\"title\":\"day xxx\",\"children\":{\"attached\":[{\"id\":\"bcc93f04-e43c-42b8-8124-ac8cb622d1bb\",\"title\":\"Testing\",\"children\":{\"attached\":[{\"title\":\"Minstry of testing promocja\",\"id\":\"a486f559-aa06-4354-88f4-d4aa83c5b933\"}]}},{\"id\":\"bb6d9cf2-f1e9-4e0a-81b5-5e15fe3e1f5f\",\"title\":\"programming\"},{\"id\":\"f449a122-abc4-4899-9e5b-72bceaa86094\",\"title\":\"Craftsmanship/Busisness/Softskill\",\"children\":{\"attached\":[{\"id\":\"11e01448-6a07-47e5-955a-a80c3d721b73\",\"title\":\"https://dev.to/cilvako/how-do-you-get-over-bad-days-4mo0\"}]}},{\"id\":\"95e60084-7f74-498f-b91f-ba28c4e7c530\",\"title\":\"Other\"}]}},{\"id\":\"5866b566-4f71-4592-bf80-c22a3fd878f8\",\"title\":\"day xxx\",\"children\":{\"attached\":[{\"id\":\"b0c10d86-439e-44c6-b1c6-02d59b786c52\",\"title\":\"Testing\"},{\"id\":\"2e980446-3b60-4573-8b9d-a2885757df42\",\"title\":\"programming\"},{\"id\":\"30da912c-4016-41b9-a146-2fe969860aa0\",\"title\":\"Craftsmanship/Busisness/Softskill\"},{\"id\":\"6bd75631-f1b0-4966-9fad-52ea7004644b\",\"title\":\"Other\"}]}},{\"id\":\"ae1e4989-c3bc-4092-8f81-3b1cc401e68a\",\"title\":\"day xxx\",\"children\":{\"attached\":[{\"id\":\"36ebb2a8-4cba-420f-9579-a4e1749acdc0\",\"title\":\"Testing\"},{\"id\":\"ef0b22a8-a70c-48bf-a63b-c196db264f56\",\"title\":\"programming\"},{\"id\":\"8ac920de-c866-46a0-90a7-4c6ad0d2a652\",\"title\":\"Craftsmanship/Busisness/Softskill\"},{\"id\":\"4de7098a-3265-4bce-ab3f-4110688412de\",\"title\":\"Other\"}]}},{\"id\":\"c94ac84f-22e7-4a4f-a45d-eb2db4502647\",\"title\":\"day xxx\",\"children\":{\"attached\":[{\"id\":\"afe37213-5a36-49b7-801e-ad06ac2e9bb1\",\"title\":\"Testing\"},{\"id\":\"631a432b-c181-42af-a31d-c746a20426ad\",\"title\":\"programming\"},{\"id\":\"acee93a9-9658-4864-9232-e3a57fbbcb8b\",\"title\":\"Craftsmanship/Busisness/Softskill\"},{\"id\":\"c14c6b51-f485-4704-87a1-e6eb6a8a77a1\",\"title\":\"Other\"}]}}]}},\"theme\":{\"id\":\"6518e97a4149b5f96691ab3b5d\",\"importantTopic\":{\"type\":\"topic\",\"properties\":{\"fo:font-weight\":\"bold\",\"fo:color\":\"#333333\",\"svg:fill\":\"#FFFF00\"}},\"minorTopic\":{\"type\":\"topic\",\"properties\":{\"fo:font-weight\":\"bold\",\"fo:color\":\"#333333\",\"svg:fill\":\"#FFCB88\"}},\"expiredTopic\":{\"type\":\"topic\",\"properties\":{\"fo:font-style\":\"italic\",\"fo:text-decoration\":\" line-through\"}},\"centralTopic\":{\"properties\":{\"fo:font-family\":\"NeverMind\",\"fo:font-weight\":\"600\",\"fo:font-style\":\"normal\",\"fo:font-size\":\"28pt\",\"shape-class\":\"org.xmind.topicShape.roundedRect\",\"svg:fill\":\"#0288D1\",\"line-class\":\"org.xmind.branchConnection.curve\",\"line-width\":\"2\",\"line-color\":\"#333333\",\"border-line-width\":\"0\"},\"styleId\":\"9a94e1a0-7e67-48df-a231-7fa0c60b7b97\",\"type\":\"topic\"},\"boundary\":{\"properties\":{\"fo:font-family\":\"NeverMind\",\"fo:color\":\"#FFFFFF\",\"fo:font-weight\":\"500\",\"svg:fill\":\"#D5E9FC\",\"shape-class\":\"org.xmind.boundaryShape.roundedRect\",\"line-pattern\":\"dash\",\"line-color\":\"#0288D1\",\"fo:font-style\":\"normal\",\"fo:font-size\":\"13pt\"},\"styleId\":\"94a6c549-690c-4f1e-b18f-457f114abcb0\",\"type\":\"boundary\"},\"floatingTopic\":{\"properties\":{\"fo:font-family\":\"NeverMind\",\"fo:font-weight\":\"600\",\"fo:font-size\":\"13pt\",\"shape-class\":\"org.xmind.topicShape.roundedRect\",\"svg:fill\":\"#333333\",\"fo:font-style\":\"normal\",\"fo:color\":\"#FFFFFF\",\"border-line-width\":\"0\",\"border-line-color\":\"none\",\"line-class\":\"org.xmind.branchConnection.roundedElbow\",\"line-width\":\"1\",\"line-color\":\"#333333\"},\"styleId\":\"8286b472-0630-4970-8bf1-510a831dc2b9\",\"type\":\"topic\"},\"subTopic\":{\"properties\":{\"fo:font-weight\":\"500\",\"fo:text-align\":\"left\",\"fo:font-family\":\"NeverMind\",\"line-class\":\"org.xmind.branchConnection.roundedElbow\",\"fo:font-style\":\"normal\",\"fo:font-size\":\"13pt\",\"fo:color\":\"#333333\",\"svg:fill\":\"none\",\"shape-class\":\"org.xmind.topicShape.underline\"},\"styleId\":\"ddd92ae3-f2b4-48ee-9e47-2dacee6acac4\",\"type\":\"topic\"},\"mainTopic\":{\"properties\":{\"fo:font-weight\":\"600\",\"fo:font-family\":\"NeverMind\",\"fo:font-style\":\"normal\",\"fo:font-size\":\"20pt\",\"line-class\":\"org.xmind.branchConnection.roundedElbow\",\"line-width\":\"1\",\"line-color\":\"#333333\",\"border-line-width\":\"2\",\"border-line-color\":\"#333333\"},\"styleId\":\"7565fe37-2200-4483-b343-91bdf53e563e\",\"type\":\"topic\"},\"calloutTopic\":{\"properties\":{\"fo:font-family\":\"NeverMind\",\"fo:font-weight\":\"600\",\"fo:font-style\":\"normal\",\"callout-shape-class\":\"org.xmind.calloutTopicShape.balloon.roundedRect\",\"fo:font-size\":\"13pt\",\"fo:color\":\"#FFFFFF\"},\"styleId\":\"9bffcc6a-0526-4db5-b304-ea3830a42846\",\"type\":\"topic\"},\"summaryTopic\":{\"properties\":{\"fo:font-family\":\"NeverMind\",\"fo:font-weight\":\"600\",\"fo:font-size\":\"13pt\",\"shape-class\":\"org.xmind.topicShape.roundedRect\",\"svg:fill\":\"#333333\",\"border-line-width\":\"1\",\"border-line-color\":\"none\",\"fo:font-style\":\"normal\",\"line-class\":\"org.xmind.branchConnection.roundedElbow\",\"line-width\":\"1\",\"line-color\":\"#333333\"},\"styleId\":\"a82dc72d-29bc-4d81-bd44-3f1bee0ed35c\",\"type\":\"topic\"},\"relationship\":{\"properties\":{\"fo:font-family\":\"NeverMind\",\"fo:font-weight\":\"normal\",\"line-color\":\"#0288D1\",\"shape-class\":\"org.xmind.relationshipShape.curved\",\"line-width\":\"2\",\"fo:font-size\":\"13pt\",\"fo:color\":\"#333333\"},\"styleId\":\"1611e291-8cc1-4500-93a5-69281d5bedf0\",\"type\":\"relationship\"},\"map\":{\"type\":\"map\",\"styleId\":\"7e90467a-d643-4fa9-84f2-f8f0166e5afb\",\"properties\":{}},\"summary\":{\"type\":\"summary\",\"styleId\":\"8aa88864-8667-4627-a763-a84973e0109b\",\"properties\":{\"line-color\":\"#0288D1\",\"shape-class\":\"org.xmind.summaryShape.round\",\"line-width\":\"2\"}}},\"topicPositioning\":\"fixed\"}]";

        [SetUp]
        public void Setup()
        {
            var mock = new Mock<ILogger<TransformXmindData>>();
            sut = new TransformXmindData(mock.Object);
        }
        
        [Test]
        public void Json_Transfered_ToEpisode()
        {
            
            var jsonToEpisodes = sut.TransformJsonToEpisodes(validJson8episodes4empty);
            
            
            Assert.That(jsonToEpisodes.Count,Is.EqualTo(4));
            foreach (var episode in jsonToEpisodes)
            {
                Assert.That(episode.Articles.Count, Is.EqualTo(4));
            }
        }

        [Test]
        public void DeserializeJson()
        {
            sut.DeserializeJson(validJson8episodes4empty);
        }
        
    }
}